<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CMS Post-Auction Report Builder</title>

  <link rel="stylesheet" href="styles.css" />

  <!-- Client-only libraries -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>

<body>
  <div class="app">

    <!-- TOP BAR -->
    <header class="topbar">
      <div class="brand">
        <img src="assets/logo.png" alt="CMS Livestock Auction" class="logo" />
        <div class="brandText">
          <div class="brandTitle">CMS Auction Reporting</div>
          <div class="brandSub">Internal PDF Builder</div>
        </div>
      </div>

      <div class="topbarActions">
        <button id="exitBtn" class="btn btnGhost" title="Clears all data & resets app">
          Exit / Clear
        </button>
      </div>
    </header>

    <main class="main">

      <!-- PAGE 1: AUTH -->
      <section id="pageAuth" class="card">
        <h1>Enter PIN</h1>
        <p class="muted">Data is processed in your browser only. Nothing is uploaded or stored.</p>

        <div class="row">
          <label class="label">PIN</label>
          <input id="pinInput" class="input" type="password" inputmode="numeric" autocomplete="off" placeholder="••••" />
        </div>

        <div class="row">
          <button id="pinSubmit" class="btn">Enter</button>
        </div>

        <div id="authError" class="error hidden"></div>
      </section>

      <!-- PAGE 2: BUILDER -->
      <section id="pageBuilder" class="card hidden">
        <h1>Build PDFs</h1>
        <p class="muted">Upload a CSV and choose what you want to generate.</p>

        <div class="grid2">
          <div>
            <div class="row">
              <label class="label">Auction Title</label>
              <input id="auctionName" class="input" placeholder="e.g. CMS Weekly Video Auction" />
            </div>

            <div class="row">
              <label class="label">Auction Date / Time</label>
              <div style="display: flex; gap: 8px;">
                <input id="auctionDatePicker" type="datetime-local" class="input" style="flex: 1;" />
                <input id="auctionDate" class="input" style="flex: 2;" placeholder="e.g. February 12th, 2026 @ 1:00PM" />
              </div>
            </div>

            <div class="row">
              <label class="label">Optional Label</label>
              <input id="auctionLabel" class="input" placeholder="e.g. Special Calf Sale" />
            </div>
          </div>

          <div>
            <div class="row">
              <label class="label">Upload CSV</label>
              <div id="dropZone" class="dropZone">
                <div class="dropTitle">Drag & drop your CSV here</div>
                <div class="dropSub">or click to browse</div>
                <input id="fileInput" type="file" accept=".csv,text/csv" class="hidden" />
                <div id="fileMeta" class="file hidden"></div>
              </div>
            </div>

            <div class="row">
              
              <!-- PRE-AUCTION SECTION -->
              <div style="margin-bottom: 16px;">
                <div class="sectionLabel">
                  Pre-Auction (requires Lot Number column)
                  <span style="margin-left: 12px; font-size: 12px; font-weight: normal;">
                    <a href="#" id="selectAllPre" style="color: #336699; text-decoration: none;">Select All</a>
                    <span style="color: #999; margin: 0 4px;">|</span>
                    <a href="#" id="deselectAllPre" style="color: #336699; text-decoration: none;">Deselect All</a>
                  </span>
                </div>
                <div class="pillRow">
                  <label class="pill">
                    <input type="checkbox" id="chkPreConsignor" /> Consignor Listing Confirmations
                    <span style="margin-left: 8px; font-size: 11px; color: #666;">
                      (<label style="cursor: pointer;"><input type="checkbox" id="chkPreConsignorCondensed" style="margin: 0 4px 0 0;" />Condensed</label>)
                    </span>
                  </label>
                  <label class="pill">
                    <input type="checkbox" id="chkPreRep" /> Rep Listing Confirmations
                    <span style="margin-left: 8px; font-size: 11px; color: #666;">
                      (<label style="cursor: pointer;"><input type="checkbox" id="chkPreRepCondensed" style="margin: 0 4px 0 0;" />Condensed</label>)
                    </span>
                  </label>
                </div>
              </div>
              
              <!-- POST-AUCTION SECTION -->
              <div style="margin-bottom: 16px;">
                <div class="sectionLabel">
                  Post-Auction (requires Contract # column)
                  <span style="margin-left: 12px; font-size: 12px; font-weight: normal;">
                    <a href="#" id="selectAllPost" style="color: #336699; text-decoration: none;">Select All</a>
                    <span style="color: #999; margin: 0 4px;">|</span>
                    <a href="#" id="deselectAllPost" style="color: #336699; text-decoration: none;">Deselect All</a>
                  </span>
                </div>
                <div class="pillRow">
                  <label class="pill"><input type="checkbox" id="chkBuyer" /> Buyer Reports</label>
                  <label class="pill"><input type="checkbox" id="chkLotByLot" /> Contract Details</label>
                  <label class="pill">
                    <input type="checkbox" id="chkConsignor" /> Consignor Trade Confirmations
                    <span style="margin-left: 8px; font-size: 11px; color: #666;">
                      (<label style="cursor: pointer;"><input type="checkbox" id="chkConsignorCondensed" style="margin: 0 4px 0 0;" />Condensed</label>)
                    </span>
                  </label>
                  <label class="pill">
                    <input type="checkbox" id="chkRep" /> Rep Trade Confirmations
                    <span style="margin-left: 8px; font-size: 11px; color: #666;">
                      (<label style="cursor: pointer;"><input type="checkbox" id="chkShowCmsNotes" style="margin: 0 4px 0 0;" />Include CMS Notes</label>)
                      (<label style="cursor: pointer;"><input type="checkbox" id="chkRepCondensed" style="margin: 0 4px 0 0;" />Condensed</label>)
                    </span>
                  </label>
                </div>
              </div>

              <!-- CONTRACTS SECTION -->
              <div style="margin-bottom: 16px;">
                <div class="sectionLabel">
                  Contracts (requires Contract # column)
                  <span style="margin-left: 12px; font-size: 12px; font-weight: normal;">
                    <a href="#" id="selectAllContracts" style="color: #336699; text-decoration: none;">Select All</a>
                    <span style="color: #999; margin: 0 4px;">|</span>
                    <a href="#" id="deselectAllContracts" style="color: #336699; text-decoration: none;">Deselect All</a>
                  </span>
                </div>
                <div class="pillRow">
                  <label class="pill"><input type="checkbox" id="chkBuyerContracts" /> Buyer Contracts</label>
                  <label class="pill"><input type="checkbox" id="chkSellerContracts" /> Seller Contracts</label>
                </div>
              </div>

              <!-- SPECIAL REPORTS SECTION -->
              <div style="margin-bottom: 16px;">
                <div class="sectionLabel">
                  Special Reports (requires Contract # column)
                  <span style="margin-left: 12px; font-size: 12px; font-weight: normal;">
                    <a href="#" id="selectAllSpecial" style="color: #336699; text-decoration: none;">Select All</a>
                    <span style="color: #999; margin: 0 4px;">|</span>
                    <a href="#" id="deselectAllSpecial" style="color: #336699; text-decoration: none;">Deselect All</a>
                  </span>
                </div>
                <div class="pillRow">
                  <label class="pill"><input type="checkbox" id="chkSalesByConsignor" /> Sales Summary by Consignor</label>
                  <label class="pill"><input type="checkbox" id="chkSalesByBuyer" /> Sales Summary by Buyer</label>
                  <label class="pill"><input type="checkbox" id="chkSalesByRep" /> Sales Summary by Rep</label>
                  <label class="pill"><input type="checkbox" id="chkCompleteBuyer" /> Complete Buyer Summary</label>
                  <label class="pill"><input type="checkbox" id="chkCompleteConsignor" /> Complete Consignor Summary</label>
                  <label class="pill"><input type="checkbox" id="chkAuctionRecap" /> Auction Recap Summary</label>
                </div>
              </div>

              <div class="muted small" style="margin-top:6px;">
                Rep PDFs ignore rows where <b>Representative</b> or <b>Rep</b> is blank.
              </div>
              
              <!-- CSV VALIDATION PREVIEW -->
              <div id="csvPreview" class="hidden" style="margin-top: 16px; padding: 12px; background: #e8f4f8; border: 1px solid #336699; border-radius: 4px;">
                <div style="font-weight: 600; margin-bottom: 8px; color: #336699;">Ready to Generate</div>
                <div id="csvPreviewContent" style="font-size: 13px; line-height: 1.6; color: #333;"></div>
              </div>
            </div>

            <div class="row">
              <button id="buildBtn" class="btn" disabled>Generate PDFs</button>
            </div>

            <div id="builderError" class="error hidden"></div>
          </div>
        </div>
      </section>

      <!-- PAGE 3: RESULTS -->
      <section id="pageResults" class="card hidden">
        <h1>Generated PDFs</h1>
        <p class="muted">Download individually or as ZIPs. Nothing persists after refresh or exit.</p>

        <div class="resultsGrid">

          <!-- PRE-AUCTION DOWNLOADS -->
          <div style="grid-column: 1 / -1; margin: 24px 0 12px 0; padding-bottom: 8px; border-bottom: 2px solid #336699;">
            <h2 style="margin: 0; font-size: 16px; color: #336699; font-weight: 600;">PRE-AUCTION DOWNLOADS</h2>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Consignor Listing Confirmations</h3>
              <div class="resultsHeaderRight">
                <button id="zipPreConsignorReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togPreConsignorReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listPreConsignorReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listPreConsignorReports" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Rep Listing Confirmations</h3>
              <div class="resultsHeaderRight">
                <button id="zipPreRepReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togPreRepReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listPreRepReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listPreRepReports" class="list collapsible collapsed"></div>
          </div>

          <!-- POST-AUCTION DOWNLOADS -->
          <div style="grid-column: 1 / -1; margin: 24px 0 12px 0; padding-bottom: 8px; border-bottom: 2px solid #336699;">
            <h2 style="margin: 0; font-size: 16px; color: #336699; font-weight: 600;">POST-AUCTION DOWNLOADS</h2>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Buyer Reports</h3>
              <div class="resultsHeaderRight">
                <button id="zipBuyerReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togBuyerReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listBuyerReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listBuyerReports" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Contract Details (Lot-by-lot)</h3>
              <div class="resultsHeaderRight">
                <button id="zipLotByLot" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togLotByLot" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listLotByLot" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listLotByLot" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Consignor Trade Confirmations</h3>
              <div class="resultsHeaderRight">
                <button id="zipConsignorReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togConsignorReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listConsignorReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listConsignorReports" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Rep Trade Confirmations</h3>
              <div class="resultsHeaderRight">
                <button id="zipRepReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togRepReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listRepReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listRepReports" class="list collapsible collapsed"></div>
          </div>

          <!-- CONTRACTS -->
          <div style="grid-column: 1 / -1; margin: 24px 0 12px 0; padding-bottom: 8px; border-bottom: 2px solid #336699;">
            <h2 style="margin: 0; font-size: 16px; color: #336699; font-weight: 600;">CONTRACTS</h2>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Buyer Contracts</h3>
              <div class="resultsHeaderRight">
                <button id="zipBuyerContracts" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togBuyerContracts" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listBuyerContracts" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listBuyerContracts" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Seller Contracts</h3>
              <div class="resultsHeaderRight">
                <button id="zipSellerContracts" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togSellerContracts" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listSellerContracts" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listSellerContracts" class="list collapsible collapsed"></div>
          </div>

          <!-- SPECIAL REPORTS -->
          <div style="grid-column: 1 / -1; margin: 24px 0 12px 0; padding-bottom: 8px; border-bottom: 2px solid #336699;">
            <h2 style="margin: 0; font-size: 16px; color: #336699; font-weight: 600;">SPECIAL REPORTS</h2>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Sales Summaries by Consignor</h3>
              <div class="resultsHeaderRight">
                <button id="zipSalesByConsignor" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togSalesByConsignor" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listSalesByConsignor" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listSalesByConsignor" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Sales Summaries by Buyer</h3>
              <div class="resultsHeaderRight">
                <button id="zipSalesByBuyer" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togSalesByBuyer" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listSalesByBuyer" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listSalesByBuyer" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Sales Summaries by Rep</h3>
              <div class="resultsHeaderRight">
                <button id="zipSalesByRep" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togSalesByRep" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listSalesByRep" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listSalesByRep" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Complete Buyer Summary</h3>
              <div class="resultsHeaderRight">
                <button id="togCompleteBuyer" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listCompleteBuyer" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listCompleteBuyer" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Complete Consignor Summary</h3>
              <div class="resultsHeaderRight">
                <button id="togCompleteConsignor" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listCompleteConsignor" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listCompleteConsignor" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Auction Recap Summary</h3>
              <div class="resultsHeaderRight">
                <button id="togAuctionRecap" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listAuctionRecap" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listAuctionRecap" class="list collapsible collapsed"></div>
          </div>

        </div>

        <hr class="divider" />

        <div class="row spaceBetween">
          <button id="backBtn" class="btn btnGhost">Back</button>
          <div style="display: flex; gap: 12px;">
            <button id="zipSpecialReports" class="btn btnGhost" disabled>Download Special Reports ZIP</button>
            <button id="zipAll" class="btn" disabled>Download ALL as ZIP</button>
          </div>
        </div>

        <div id="resultsMeta" class="muted small"></div>
      </section>

    </main>

    <footer class="footer muted small">
      Client-only app. No CSVs or PDFs are uploaded or stored.
    </footer>
  </div>

  <!-- App -->
  <script src="app.js"></script>

  <script>
    // Make drop zone clickable
    document.addEventListener("DOMContentLoaded", () => {
      const dz = document.getElementById("dropZone");
      const fi = document.getElementById("fileInput");
      if(dz && fi){
        dz.addEventListener("click", () => fi.click());
      }
    });
  </script>
</body>
</html>
