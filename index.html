<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CMS Post-Auction Report Builder</title>

  <link rel="stylesheet" href="styles.css" />

  <!-- Client-only libraries -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>

<body>
  <div class="app">

    <!-- TOP BAR -->
    <header class="topbar">
      <div class="brand">
        <img src="assets/logo.png" alt="CMS Livestock Auction" class="logo" />
        <div class="brandText">
          <div class="brandTitle">CMS Auction Reporting</div>
          <div class="brandSub">Internal PDF Builder</div>
        </div>
      </div>

      <div class="topbarActions">
        <button id="exitBtn" class="btn btnGhost" title="Clears all data & resets app">
          Exit / Clear
        </button>
      </div>
    </header>

    <main class="main">

      <!-- PAGE 1: AUTH -->
      <section id="pageAuth" class="card">
        <h1>Enter PIN</h1>
        <p class="muted">Data is processed in your browser only. Nothing is uploaded or stored.</p>

        <div class="row">
          <label class="label">PIN</label>
          <input id="pinInput" class="input" type="password" inputmode="numeric" autocomplete="off" placeholder="••••" />
        </div>

        <div class="row">
          <button id="pinSubmit" class="btn">Enter</button>
        </div>

        <div id="authError" class="error hidden"></div>
      </section>

      <!-- PAGE 2: BUILDER -->
      <section id="pageBuilder" class="card hidden">
        <h1>Build PDFs</h1>
        <p class="muted">Upload a CSV and choose what you want to generate.</p>

        <div class="grid2">
          <div>
            <div class="row">
              <label class="label">Auction Title</label>
              <input id="auctionName" class="input" placeholder="e.g. CMS Weekly Video Auction" />
            </div>

            <div class="row">
              <label class="label">Auction Date / Time</label>
              <input id="auctionDate" class="input" placeholder="e.g. Feb 12, 2026 — 10:00 AM CT" />
            </div>

            <div class="row">
              <label class="label">Optional Label</label>
              <input id="auctionLabel" class="input" placeholder="e.g. Special Calf Sale" />
            </div>
          </div>

          <div>
            <div class="row">
              <label class="label">Upload CSV</label>
              <div id="dropZone" class="dropZone">
                <div class="dropTitle">Drag & drop your CSV here</div>
                <div class="dropSub">or click to browse</div>
                <input id="fileInput" type="file" accept=".csv,text/csv" class="hidden" />
                <div id="fileMeta" class="file hidden"></div>
              </div>
            </div>

            <div class="row">
              <label class="label">What to Generate</label>
              
              <!-- POST-AUCTION SECTION -->
              <div style="margin-bottom: 16px;">
                <div class="sectionLabel">Post-Auction (requires Contract # column)</div>
                <div class="pillRow">
                  <label class="pill"><input type="checkbox" id="chkBuyer" /> Buyer Reports</label>
                  <label class="pill"><input type="checkbox" id="chkLotByLot" /> Contract Details</label>
                  <label class="pill"><input type="checkbox" id="chkBuyerContracts" /> Buyer Contracts</label>
                  <label class="pill"><input type="checkbox" id="chkSellerContracts" /> Seller Contracts</label>
                  <label class="pill"><input type="checkbox" id="chkConsignor" /> Consignor Trade Confirmations</label>
                  <label class="pill"><input type="checkbox" id="chkRep" /> Rep Trade Confirmations</label>
                </div>
              </div>

              <!-- PRE-AUCTION SECTION -->
              <div>
                <div class="sectionLabel">Pre-Auction (requires Lot Number column)</div>
                <div class="pillRow">
                  <label class="pill"><input type="checkbox" id="chkPreConsignor" /> Consignor Listing Confirmations</label>
                  <label class="pill"><input type="checkbox" id="chkPreRep" /> Rep Listing Confirmations</label>
                </div>
              </div>

              <div class="muted small" style="margin-top:6px;">
                Rep PDFs ignore rows where <b>Representative</b> or <b>Rep</b> is blank.
              </div>
            </div>

            <div class="row">
              <button id="buildBtn" class="btn" disabled>Generate PDFs</button>
            </div>

            <div id="builderError" class="error hidden"></div>
          </div>
        </div>
      </section>

      <!-- PAGE 3: RESULTS -->
      <section id="pageResults" class="card hidden">
        <h1>Generated PDFs</h1>
        <p class="muted">Download individually or as ZIPs. Nothing persists after refresh or exit.</p>

        <div class="resultsGrid">

          <!-- POST-AUCTION RESULTS -->
          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Buyer Reports</h3>
              <div class="resultsHeaderRight">
                <button id="zipBuyerReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togBuyerReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listBuyerReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listBuyerReports" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Contract Details (Lot-by-lot)</h3>
              <div class="resultsHeaderRight">
                <button id="zipLotByLot" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togLotByLot" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listLotByLot" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listLotByLot" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Buyer Contracts</h3>
              <div class="resultsHeaderRight">
                <button id="zipBuyerContracts" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togBuyerContracts" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listBuyerContracts" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listBuyerContracts" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Seller Contracts</h3>
              <div class="resultsHeaderRight">
                <button id="zipSellerContracts" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togSellerContracts" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listSellerContracts" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listSellerContracts" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Consignor Trade Confirmations</h3>
              <div class="resultsHeaderRight">
                <button id="zipConsignorReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togConsignorReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listConsignorReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listConsignorReports" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Rep Trade Confirmations</h3>
              <div class="resultsHeaderRight">
                <button id="zipRepReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togRepReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listRepReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listRepReports" class="list collapsible collapsed"></div>
          </div>

          <!-- PRE-AUCTION RESULTS -->
          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Consignor Listing Confirmations</h3>
              <div class="resultsHeaderRight">
                <button id="zipPreConsignorReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togPreConsignorReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listPreConsignorReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listPreConsignorReports" class="list collapsible collapsed"></div>
          </div>

          <div class="resultsCol">
            <div class="resultsHeader">
              <h3>Rep Listing Confirmations</h3>
              <div class="resultsHeaderRight">
                <button id="zipPreRepReports" class="btn btnSmall btnGhost" disabled>ZIP</button>
                <button id="togPreRepReports" class="toggleBtn" type="button" aria-expanded="false" aria-controls="listPreRepReports" title="Expand/Collapse">
                  <span class="chev">▾</span>
                </button>
              </div>
            </div>
            <div id="listPreRepReports" class="list collapsible collapsed"></div>
          </div>

        </div>

        <hr class="divider" />

        <div class="row spaceBetween">
          <button id="backBtn" class="btn btnGhost">Back</button>
          <button id="zipAll" class="btn" disabled>Download ALL as ZIP</button>
        </div>

        <div id="resultsMeta" class="muted small"></div>
      </section>

    </main>

    <footer class="footer muted small">
      Client-only app. No CSVs or PDFs are uploaded or stored.
    </footer>
  </div>

  <!-- App -->
  <script src="app.js"></script>

  <script>
    // Make drop zone clickable
    document.addEventListener("DOMContentLoaded", () => {
      const dz = document.getElementById("dropZone");
      const fi = document.getElementById("fileInput");
      if(dz && fi){
        dz.addEventListener("click", () => fi.click());
      }
    });
  </script>
</body>
</html>
